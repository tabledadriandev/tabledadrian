// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id            String   @id @default(cuid())
  walletAddress String   @unique
  email         String?
  username      String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Profile
  profile       UserProfile?
  
  // Health & Wellness
  healthData    HealthData[]
  mealPlans     MealPlan[]
  recipes       Recipe[]
  challenges    ChallengeProgress[]
  achievements  Achievement[]
  
  // Comprehensive Health Features (Neko Health inspired)
  healthAssessments HealthAssessment[]
  biomarkers        Biomarker[]
  symptomLogs       SymptomLog[]
  healthScores      HealthScore[]
  cameraAnalyses    CameraAnalysis[]
  wellnessPlans     WellnessPlan[]
  mealLogs          MealLog[]
  dailyHabits       DailyHabits[]
  healthReports     HealthReport[]
  
  // Social
  posts         Post[]
  comments      Comment[]
  followers     Follow[]  @relation("UserFollowers")
  following     Follow[] @relation("UserFollowing")
  messages      Message[] @relation("SentMessages")
  receivedMessages Message[] @relation("ReceivedMessages")
  
  // Token & Rewards
  tokenBalance  Float    @default(0)
  stakedAmount  Float    @default(0)
  rewards       Reward[]
  transactions  Transaction[]
  
  // Gamification
  xp            Int      @default(0)
  level         Int      @default(1)
  streak        Int      @default(0)
  lastCheckIn   DateTime?
  
  // NFT
  nfts          NFT[]
}

model UserProfile {
  id          String   @id @default(cuid())
  userId      String   @unique
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  firstName   String?
  lastName    String?
  bio         String?
  avatar      String?
  age         Int?
  gender      String?
  height      Float?   // cm
  weight      Float?   // kg
  activityLevel String? // sedentary, light, moderate, active, very_active
  healthGoals String[] // weight_loss, muscle_gain, longevity, diabetes, heart_health, etc.
  allergies   String[]
  dietaryRestrictions String[] // vegan, vegetarian, keto, paleo, etc.
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model HealthData {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type          String   // steps, sleep, heart_rate, blood_pressure, glucose, mood, weight, etc.
  value         Float
  unit          String?
  notes         String?
  source        String?  // manual, apple_watch, fitbit, oura, etc.
  recordedAt    DateTime @default(now())
  createdAt     DateTime @default(now())
}

model MealPlan {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name          String
  description   String?
  startDate     DateTime
  endDate       DateTime?
  meals         Meal[]
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Meal {
  id            String   @id @default(cuid())
  mealPlanId    String
  mealPlan      MealPlan @relation(fields: [mealPlanId], references: [id], onDelete: Cascade)
  
  type          String   // breakfast, lunch, dinner, snack
  name          String
  description   String?
  calories      Int?
  protein       Float?
  carbs         Float?
  fat           Float?
  fiber         Float?
  ingredients   String[]
  instructions  String?
  image         String?
  date          DateTime
  completed     Boolean  @default(false)
  createdAt     DateTime @default(now())
}

model Recipe {
  id            String   @id @default(cuid())
  userId        String?
  user          User?    @relation(fields: [userId], references: [id], onDelete: SetNull)
  
  name          String
  description   String
  image         String?
  prepTime      Int?     // minutes
  cookTime      Int?     // minutes
  servings      Int?
  calories      Int?
  protein       Float?
  carbs         Float?
  fat           Float?
  ingredients   Json     // Array of {name, amount, unit}
  instructions  String[]
  tags          String[]
  isPublic      Boolean  @default(false)
  likes         Int      @default(0)
  views         Int      @default(0)
  posts         Post[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Challenge {
  id            String   @id @default(cuid())
  name          String
  description   String
  type          String   // daily, weekly, seasonal, event
  startDate     DateTime
  endDate       DateTime?
  requirements  Json     // Challenge requirements
  rewards       Json     // Reward structure
  isActive      Boolean  @default(true)
  participants  ChallengeProgress[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model ChallengeProgress {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  challengeId   String
  challenge     Challenge @relation(fields: [challengeId], references: [id], onDelete: Cascade)
  
  progress      Json     // Progress data
  completed     Boolean  @default(false)
  completedAt   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  @@unique([userId, challengeId])
}

model Achievement {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type          String   // streak, level, challenge, milestone, etc.
  name          String
  description   String
  icon          String?
  nftMinted     Boolean  @default(false)
  nftTokenId    String?
  earnedAt      DateTime @default(now())
}

model Post {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  content       String
  images        String[]
  recipeId      String?
  recipe        Recipe?  @relation(fields: [recipeId], references: [id], onDelete: SetNull)
  likes         Int      @default(0)
  comments      Comment[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Comment {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  postId        String
  post          Post     @relation(fields: [postId], references: [id], onDelete: Cascade)
  
  content       String
  likes         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Follow {
  id            String   @id @default(cuid())
  followerId    String
  follower      User     @relation("UserFollowers", fields: [followerId], references: [id], onDelete: Cascade)
  followingId   String
  following     User     @relation("UserFollowing", fields: [followingId], references: [id], onDelete: Cascade)
  
  createdAt     DateTime @default(now())
  
  @@unique([followerId, followingId])
}

model Message {
  id            String   @id @default(cuid())
  senderId      String
  sender        User     @relation("SentMessages", fields: [senderId], references: [id], onDelete: Cascade)
  recipientId   String
  recipient     User     @relation("ReceivedMessages", fields: [recipientId], references: [id], onDelete: Cascade)
  
  content       String
  read          Boolean  @default(false)
  createdAt     DateTime @default(now())
}

model Reward {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type          String   // checkin, meal_tracked, recipe_shared, challenge_completed, referral, etc.
  amount        Float
  description   String
  claimed       Boolean  @default(false)
  claimedAt     DateTime?
  createdAt     DateTime @default(now())
}

model Transaction {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type          String   // reward, purchase, stake, unstake, transfer
  amount        Float
  description   String
  txHash        String?
  status        String   @default("pending") // pending, completed, failed
  createdAt     DateTime @default(now())
}

model NFT {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  tokenId       String   @unique
  type          String   // achievement, recipe, chef_experience, vip_access
  name          String
  description   String
  image         String
  metadata      Json?
  mintedAt      DateTime @default(now())
}

model Partnership {
  id            String   @id @default(cuid())
  companyName   String
  contactEmail  String
  contactName   String?
  website       String?
  type          String   // wellness_brand, supplement, clinic, influencer, supplier
  status        String   @default("pending") // pending, contacted, responded, partnership, rejected
  notes         String?
  outreachSent  DateTime?
  lastContact   DateTime?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model MarketplaceItem {
  id            String   @id @default(cuid())
  name          String
  description   String
  type          String   // product, service, subscription, treatment
  price         Float    // in TA tokens
  image         String?
  category      String
  stock         Int?
  isActive      Boolean  @default(true)
  sales         Int      @default(0)
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model GovernanceProposal {
  id            String   @id @default(cuid())
  title         String
  description   String
  type          String   // feature, partnership, treasury, policy
  proposer      String   // wallet address
  votesFor      Int      @default(0)
  votesAgainst  Int      @default(0)
  status        String   @default("active") // active, passed, rejected, executed
  startDate     DateTime @default(now())
  endDate       DateTime
  votes         Vote[]
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model Vote {
  id            String   @id @default(cuid())
  proposalId    String
  proposal      GovernanceProposal @relation(fields: [proposalId], references: [id], onDelete: Cascade)
  voter         String   // wallet address
  vote          String   // for, against
  weight        Float    // based on token holdings
  txHash        String?
  createdAt     DateTime @default(now())
  
  @@unique([proposalId, voter])
}


model HealthAssessment {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Personal Health History
  chronicConditions String[]
  pastSurgeries     String[]
  currentMedications String[]
  
  // Family Medical History
  familyHistory     Json   // { condition: string, relation: string }[]
  
  // Lifestyle Assessment
  sleepHours         Float?
  stressLevel        Int?    // 1-10
  exerciseFrequency  String? // daily, weekly, rarely, never
  exerciseType       String[]
  
  // Dietary Habits
  mealFrequency      String? // 3x, 4x, 5x+ per day
  foodGroups         String[] // fruits, vegetables, grains, protein, dairy
  dietaryRestrictions String[]
  waterIntake        Float?   // liters per day
  
  // Mental Health
  anxietyLevel       Int?     // 1-10
  depressionIndicators String[]
  moodStability      String?  // stable, variable, unstable
  
  // Current Symptoms
  currentSymptoms    String[]
  symptomSeverity    Json     // { symptom: string, severity: number }[]
  concerns           String[]
  
  // Risk Scores
  heartDiseaseRisk   Float?
  diabetesRisk       Float?
  hypertensionRisk   Float?
  strokeRisk         Float?
  metabolicSyndromeRisk Float?
  overallRiskScore   Float?
  
  // Health Profile
  healthProfile      Json     // Comprehensive profile object
  recommendations    String[]
  
  completedAt        DateTime @default(now())
  createdAt          DateTime @default(now())
  updatedAt          DateTime @updatedAt
}

model Biomarker {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  // Vital Signs
  bloodPressureSystolic  Int?
  bloodPressureDiastolic Int?
  heartRate              Int?
  temperature            Float?
  breathingRate          Int?
  
  // Body Composition
  weight                 Float?
  bmi                    Float?
  bodyFatPercentage      Float?
  muscleMass             Float?
  
  // Blood Work
  bloodGlucose           Float?
  cholesterolTotal       Float?
  cholesterolLDL         Float?
  cholesterolHDL         Float?
  triglycerides          Float?
  
  // Vitamins
  vitaminD               Float?
  vitaminB12             Float?
  iron                   Float?
  ferritin               Float?
  
  // Hormones
  testosterone           Float?
  cortisol               Float?
  tsh                    Float?  // Thyroid Stimulating Hormone
  t3                     Float?
  t4                     Float?
  
  // Custom Lab Values
  customValues           Json     // { name: string, value: number, unit: string }[]
  
  // Metadata
  labDate                DateTime?
  notes                  String?
  source                 String?  // manual, lab, camera
  
  recordedAt             DateTime @default(now())
  createdAt              DateTime @default(now())
}

model SymptomLog {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  date          DateTime @default(now())
  
  // Daily Metrics
  energyLevel   Int?     // 1-10
  mood          String?  // happy, anxious, depressed, neutral, stressed
  sleepQuality  Int?     // 1-10
  sleepHours    Float?
  
  // Symptoms
  painLocations String[]
  painIntensity Json     // { location: string, intensity: number }[]
  headaches     Boolean  @default(false)
  migraine      Boolean  @default(false)
  digestiveIssues String[]
  customSymptoms String[]
  
  // Context
  activities    String[]
  meals         String[]
  notes         String?
  
  createdAt     DateTime @default(now())
}

model HealthScore {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  date          DateTime @default(now())
  
  // Overall Score
  overallScore  Float    // 0-100
  
  // Category Scores
  cardiovascularScore   Float
  metabolicScore        Float
  mentalWellnessScore   Float
  physicalFitnessScore  Float
  nutritionScore        Float
  sleepScore            Float
  
  // Breakdown
  breakdown     Json     // Detailed breakdown object
  
  createdAt     DateTime @default(now())
}

model CameraAnalysis {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  type          String   // facial, body_composition, vital_signs, posture
  imageUrl      String
  imageData     String?  // Base64 or file path
  
  // Facial Analysis
  skinHealth    Json?    // { redness: number, spots: number, texture: string }
  eyeAnalysis   Json?    // { redness: number, darkCircles: boolean, fatigue: number }
  facialSymmetry Float?
  stressLevel   Int?
  estimatedAge  Int?
  actualAge     Int?
  
  // Body Composition
  measurements  Json?    // { height: number, waist: number, hip: number, chest: number }
  bodyFatEstimate Float?
  muscleSymmetry Json?   // { left: number, right: number, difference: number }
  postureAnalysis Json?   // { front: object, side: object, back: object }
  
  // Vital Signs
  heartRate     Int?
  breathingRate Int?
  stressIndicators Json?
  
  // Progress Comparison
  comparisonId  String?  // Reference to previous analysis
  progress      Json?    // Comparison data
  
  analyzedAt    DateTime @default(now())
  createdAt     DateTime @default(now())
}

model WellnessPlan {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  name          String
  description   String?
  
  // Goals
  goals         String[]
  targetDate    DateTime?
  
  // Nutrition
  calorieTarget Int?
  proteinTarget Float?
  carbTarget    Float?
  fatTarget     Float?
  mealSuggestions Json?  // Array of meal objects
  
  // Exercise
  exercisePlan  Json?    // { frequency: string, type: string[], duration: number }
  
  // Lifestyle
  sleepTarget   Float?
  stressManagement String[]
  supplementSuggestions String[] // Informational only
  
  // Weekly Plan
  weeklyTasks   Json     // Array of daily task objects
  
  isActive      Boolean  @default(true)
  startDate     DateTime @default(now())
  endDate       DateTime?
  
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

model MealLog {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  date          DateTime @default(now())
  mealType      String   // breakfast, lunch, dinner, snack
  
  // Photo-based
  imageUrl      String?
  foodsIdentified String[] // AI-identified foods
  portionSizes Json?     // { food: string, size: string }[]
  
  // Nutrition
  calories      Int?
  protein       Float?
  carbs         Float?
  fats          Float?
  fiber         Float?
  
  // Manual Entry
  foods         String[] // Manually entered foods
  notes         String?
  
  createdAt     DateTime @default(now())
}

model DailyHabits {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  date          DateTime @default(now())
  
  waterIntake   Float?   // liters
  steps         Int?
  meditationMinutes Int?
  mealsLogged   Int      @default(0)
  sleepHours    Float?
  supplements   String[] // List of supplements taken
  exerciseCompleted Boolean @default(false)
  exerciseType  String?
  exerciseDuration Int?  // minutes
  
  streak        Int      @default(0)
  notes         String?
  
  createdAt     DateTime @default(now())
}

model HealthReport {
  id            String   @id @default(cuid())
  userId        String
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  
  reportType    String   // comprehensive, monthly, custom
  reportDate    DateTime @default(now())
  
  // Report Data
  executiveSummary Json
  healthScore     Float
  keyFindings     String[]
  biomarkers      Json
  riskAssessment  Json
  recommendations String[]
  progressComparison Json?
  
  // PDF
  pdfUrl        String?
  pdfData       String?  // Base64 encoded PDF
  
  createdAt     DateTime @default(now())
}

// Comprehensive Health Features (Neko Health inspired)

